version: '3.8'

services:
  mapproxy:
    build: .
    ports:
      - "8080:8080"
    volumes:
      # Mount configuration files for live editing
      - ./config.yml:/mapproxy/config.yml:ro
      - ./config_layers.yml:/mapproxy/config_layers.yml:ro
      - ./sources:/mapproxy/sources:ro
      - ./log.ini:/mapproxy/log.ini:ro
      - ./run_mapproxy.py:/mapproxy/run_mapproxy.py:ro
      - ./endpoints:/mapproxy/endpoints:ro
      # Request logs (source URLs) for debugging
      - ./mapproxy_log:/mapproxy/mapproxy_log
    environment:
      - MAPPROXY_PROCESSES=1
      - MAPPROXY_THREADS=4
    restart: unless-stopped

  # Optional: Add a simple web server to serve the demo links
  demo:
    image: nginx:alpine
    ports:
      - "8888:80"
    volumes:
      - ./demo_links:/usr/share/nginx/html:ro
      - ./demo_links/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - mapproxy
    restart: unless-stopped
