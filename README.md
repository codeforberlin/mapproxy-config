mapproxy-config
===============

Avaliable URLs and OpenStreetMap-Editing-URL
-------


| Name | URL | Example Usage: Edit OpenStreetMap (OSM) |
|---|---|---|
| Berlin 1928 | `https://mapproxy.codefor.de/tiles/1.0.0/1928/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/1928/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Berlin 1953 | `https://mapproxy.codefor.de/tiles/1.0.0/1953/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/1953/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Digitale farbige Orthophotos 2013 (DOP20RGB) | `https://mapproxy.codefor.de/tiles/1.0.0/2013/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2013/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Digitale Color-Infrarot-Orthophotos 2015 (DOP20CIR) | `https://mapproxy.codefor.de/tiles/1.0.0/2015_cir/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2015_cir/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Digitale Color-Infrarot-Orthophotos 2016 (DOP20CIR) | `https://mapproxy.codefor.de/tiles/1.0.0/2016_cir/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2016_cir/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Digitale farbige Orthophotos 2018 (DOP20RGB) | `https://mapproxy.codefor.de/tiles/1.0.0/2018/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2018/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Digitale farbige Orthophotos 2019 (DOP20RGB) | `https://mapproxy.codefor.de/tiles/1.0.0/2019/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2019/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| ALKIS Berlin (Amtliches Liegenschaftskatasterinformationssystem) | `https://mapproxy.codefor.de/tiles/1.0.0/alkis_30/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/alkis_30/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| "ATKIS\xAE DOM - Digitales Oberfl\xE4chenmodell" | `https://mapproxy.codefor.de/tiles/1.0.0/atkis_dom/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/atkis_dom/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| "ATKIS\xAE DGM - Digitales Gel\xE4ndemodell" | `https://mapproxy.codefor.de/tiles/1.0.0/atkis_dgm_1/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/atkis_dgm_1/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| "ATKIS\xAE DGM - Digitales Gel\xE4ndemodell" | `https://mapproxy.codefor.de/tiles/1.0.0/atkis_dgm_3/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/atkis_dgm_3/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| "Stra\xDFenbefahrung 2014" | `https://mapproxy.codefor.de/tiles/1.0.0/strassenbefahrung/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/strassenbefahrung/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| TopPlusOpen | `https://mapproxy.codefor.de/tiles/1.0.0/topplus_p5/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/topplus_p5/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| TopPlusOpen web | `https://mapproxy.codefor.de/tiles/1.0.0/topplus_web/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/topplus_web/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| WebAtlas Berlin | `https://mapproxy.codefor.de/tiles/1.0.0/webatlas/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/webatlas/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Berlin Zoom | `https://mapproxy.codefor.de/tiles/1.0.0/zoom/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/zoom/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Baumbestand Berlin - Straßenbäume | `https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_0/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_0/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Baumbestand Berlin - Anlagenbäume | `https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_1/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_1/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Baumbestand Berlin - Anlagenbäume ohne Datenbankeintrag | `https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_3/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_3/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |
| Baumbestand Berlin - Straßenbäume ohne Datenbankeintrag | `https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_4/mercator/{z}/{x}/{y}.png` | [Use to edit OSM](https://www.openstreetmap.org/edit/#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_4/mercator/{z}/{x}/{y}.png%23https://tiles.codefor.de/berlin-2020-truedop/{zoom}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) |



Install
-------

```
python3 -m venv env
source env/bin/activate
pip install -r requirements.txt
```

Run local
---------

```
mapproxy-util serve-develop config.yml
```

Deploment
---------

```
# creates the wsgi.py script
mapproxy-util create -t wsgi-app -f config.yml wsgi.py
```

Create a systemd service script in `/etc/systemd/system/mapproxy.service`.

```
[Unit]
Description=Mapproxy gunicorn daemon
After=network.target

[Service]
User=tiles
Group=tiles
WorkingDirectory=/srv/tiles/proxy
ExecStart=/srv/tiles/proxy/env/bin/gunicorn --access-logfile /var/log/mapproxy/access.log --error-logfile /var/log/mapproxy/error.log --bind unix:/tmp/mapproxy.sock --workers 9 wsgi:application

[Install]
WantedBy=multi-user.target
```

```bash
systemctl daemon-reload
systemctl start mapproxy
```

Add to nginx configuration:

```
    location /proxy/ {
        proxy_pass http://unix:/tmp/mapproxy.sock;
        proxy_set_header Host $http_host;
        proxy_set_header X-Script-Name /proxy;
    }
```

```bash
nginx -t
systemctl start nginx
```


Useful WMS query params
-----------------------

```
?service=WMS&request=GetCapabilities&version=1.1.1

?format=image%2Fpng&height=512&bbox=388800.010065,5818137.195276,393794.488433,5821374.047744&layers=0&srs=ESPG:25833&style=default&service=WMS&request=GetMap&width=512&version=1.1.1

?width=512&height=512&bbox=388800,5818137,393794,5821374&layers=0&srs=EPSG:4326&styles=default&format=image/png&service=WMS&request=GetMap&version=1.1.1
```
